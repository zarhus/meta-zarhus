Upstream-Status: Pending

From 7ba80b1feed9b06b6fe910e46c2372123f611906 Mon Sep 17 00:00:00 2001
From: Daniil Klimuk <daniil.klimuk@3mdeb.com>
Date: Mon, 9 Sep 2024 12:01:53 +0200
Subject: [PATCH] rk356x: add OP-TEE

Signed-off-by: Daniil Klimuk <daniil.klimuk@3mdeb.com>
---
 arch/arm64/boot/dts/rockchip/rk356x.dtsi | 23 +++++++++++++++++++++++
 1 file changed, 28 insertions(+)

diff --git a/arch/arm64/boot/dts/rockchip/rk356x.dtsi b/arch/arm64/boot/dts/rockchip/rk356x.dtsi
index 2f885bc3665b..4895080fba13 100644
--- a/arch/arm64/boot/dts/rockchip/rk356x.dtsi
+++ b/arch/arm64/boot/dts/rockchip/rk356x.dtsi
@@ -45,6 +45,22 @@ aliases {
 		spi3 = &spi3;
 	};
 
+	reserved-memory {
+		#address-cells = <2>;
+		#size-cells = <2>;
+		ranges;
+
+		// Memory for OP-TEE OS use only:
+		optee@8400000 {
+			reg = <0x0 0x08400000 0x0 0x02000000>;
+                       no-map;
+		};
+
+		optee_shm: optee_shared_mem@a400000 {
+			reg = <0x0 0x0a400000 0x0 0x00400000>;
+		};
+	};
+
 	cpus {
 		#address-cells = <2>;
 		#size-cells = <0>;
@@ -147,6 +159,11 @@ scmi_clk: protocol@14 {
 				#clock-cells = <1>;
 			};
 		};
+
+		optee: optee {
+			compatible = "linaro,optee-tz";
+			method = "smc";
+			shm = <&optee_shm>;
+		};
 	};
 
 	gpu_opp_table: opp-table-1 {
-- 
2.46.0

